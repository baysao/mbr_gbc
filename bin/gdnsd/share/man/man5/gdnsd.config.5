.\" Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "GDNSD.CONFIG 5"
.TH GDNSD.CONFIG 5 "2023-01-13" "gdnsd 3.8.0" "gdnsd"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
gdnsd.config \- gdnsd configuration file
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 4
\&  options => {
\&    tcp_timeout => 15 ; zonefile\-style comment
\&    listen => [ 127.0.0.1, 192.0.2.1 ]
\&  }
\&
\&  # shell\-style comment
\&
\&  service_types => {
\&    foosvc => { plugin => http_status, vhost => www.example.com, url_path => "/checkme" }
\&    barsvc => $include{bar\-svc.cfg}
\&    $include{other\-services.cfg}
\&  }
\&
\&  plugins => {
\&    null => {}
\&  }
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This man page describes the syntax of the primary gdnsd
configuration file.  The primary config file is always the
the file named \fIconfig\fR in the configuration directory.
The default configuration directory is \fI/tmp/gbc/bin/gdnsd/etc/gdnsd\fR,
but this can be overridden by the \f(CW\*(C`\-c\*(C'\fR commandline option.
.PP
The lower-level syntax and structure of the configuration
language is described in detail at the end of this document,
but it should be fairly intuitive from the example above.  It
is effectively a generic data structure language allowing
arbitrarily-nested ordered hashes, ordered arrays, and scalar
values.  Double-quotes are used to quote scalars containing
whitespace or various ambiguous metacharacters.
.PP
The top-level implicit hash of a gdnsd configuration file allows
only 3 legal keys: \fBoptions\fR, \fBservice_types\fR, and \fBplugins\fR.
.PP
Any of them which are present must have a Hash as their value.
.PP
All of them are optional, as is the configuration file itself.
If you're happy with an all-default configuration, you can
simply not have a config file at all.
.SH "OPTIONS HASH"
.IX Header "OPTIONS HASH"
These options control the overall behavior of \fBgdnsd\fR\|(8).
.IP "\fBzones_default_ttl\fR" 4
.IX Item "zones_default_ttl"
Integer seconds, default 86400.  This is the global default
time-to-live for any record in any zonefile.  It can be overridden with
a more specific default within zone files themselves via the \f(CW$TTL\fR
directive (see \fBgdnsd.zonefile\fR\|(5)).
.IP "\fBmax_ttl\fR" 4
.IX Item "max_ttl"
Integer seconds, default 3600000 (~42 days),
range 3600 \- 268435455 (2^28\-1, ~8.5 years).
This is the global maximum \s-1TTL.\s0  Any \s-1TTL\s0 found in a zone which
exceeds this value will be clamped to this value with a warning.
Note that the default maximum value is what the Internet's root
nameservers currently use for A\-record TTLs, and those are arguably
the most stable records in the whole system.  It's hard to imagine
good reasons to raise this value in practice.
.IP "\fBmin_ttl\fR" 4
.IX Item "min_ttl"
Integer seconds, default 5, range 0 \- 86400 (1 day).
This is the global minimum \s-1TTL.\s0  Any \s-1TTL\s0 found in a zone which
is below this value will be clamped to this value with a warning,
including the minimum TTLs of DYN[\s-1AC\s0] records and \s-1SOA\s0 ncache TTLs.
This value must be less than or equal to max_ttl.
.IP "\fBmax_ncache_ttl\fR" 4
.IX Item "max_ncache_ttl"
Integer seconds, default 10800, range 10 \- 86400.
This is the global maximum for the \s-1SOA\s0 negative-cache \s-1TTL\s0 field.
Values above this will be clamped with a warning.  This value
must be greater than or equal to min_ttl.
.IP "\fBdns_port\fR" 4
.IX Item "dns_port"
Integer port, 1\-65535, default 53.  This is the global default port
number for \s-1DNS\s0 listener addresses which do not specify port numbers
themselves.
.IP "\fBlisten\fR" 4
.IX Item "listen"
The listen option specifies the socket addresses the server listens on
for \s-1DNS\s0 requests.
.Sp
A listen-address specification is an \s-1IP\s0 (v4 or v6) address specified as
a numeric string with standard formatting (anything numeric that
\&\f(CW\*(C`getaddrinfo()\*(C'\fR supports on your platform), optionally followed by a
colon and a port number.  If no port number is specified, it defaults
to the value from \f(CW\*(C`dns_port\*(C'\fR, which defaults to \f(CW53\fR.
.Sp
Due to various parsing ambiguities, if you wish to specify a
non-default port number for an IPv6 listen address, you will have to
enclose the address part in square brackets, and then enclose the
entire string in double-quotes.
.Sp
The structure of the listen option as a whole can take one of three
basic forms.  In its simplest form, it is just a single listen-address
specification as a string, such as:
.Sp
.Vb 1
\&  options => { listen = 192.0.2.1 }
.Ve
.Sp
It can also take the form of an array of such addresses, as in:
.Sp
.Vb 8
\&  options => {
\&    listen = [
\&      192.0.2.1,
\&      192.0.2.2,
\&      2001:DB8::1,
\&      "[2001:DB8::1234]:53035",
\&    ]
\&  }
.Ve
.Sp
It can also be a hash where the keys are listen addresses, and the values are
per-address options, as in:
.Sp
.Vb 10
\&  options => {
\&    listen => {
\&      192.0.2.1 => {
\&        tcp_timeout = 15
\&      },
\&      192.0.2.2:53035 => {
\&        udp_threads = 5
\&      },
\&    }
\&  }
.Ve
.Sp
The per-address options (which are identical to, and locally override,
the global option of the same name) are \f(CW\*(C`tcp_threads\*(C'\fR,
\&\f(CW\*(C`tcp_timeout\*(C'\fR, \f(CW\*(C`tcp_clients_per_thread\*(C'\fR, \f(CW\*(C`tcp_fastopen\*(C'\fR, \f(CW\*(C`udp_threads\*(C'\fR,
\&\f(CW\*(C`udp_rcvbuf\*(C'\fR, and \f(CW\*(C`udp_sndbuf\*(C'\fR.
.Sp
Finally, it can also be set to the special string value \f(CW\*(C`any\*(C'\fR, as in:
.Sp
.Vb 1
\&  options => { listen => any }
.Ve
.Sp
In this mode, the daemon will listen on the \f(CW\*(C`dns_port\*(C'\fR port (default 53) on
the IPv4 and IPv6 \f(CW\*(C`ANY\*(C'\fR addresses \f(CW0.0.0.0\fR and \f(CW\*(C`::\*(C'\fR.  gdnsd's
\&\f(CW\*(C`ANY\*(C'\fR\-address sockets should correctly handle sending outgoing datagrams via
the interface they were received on with a source address matching the
destination address of the request.
.Sp
Production configurations should always explicitly define their \f(CW\*(C`listen\*(C'\fR
option, as the default could be subject to breaking changes in major version
upgrades.  The current default is the \f(CW\*(C`any\*(C'\fR behavior above.
.IP "\fBtcp_threads\fR" 4
.IX Item "tcp_threads"
Integer, default 2, min 1, max 1024.  This is the number of separate
\&\s-1TCP\s0 listening sockets and corresponding listener threads that will be created
for each \s-1DNS\s0 listener address.  On a multi-core host, increasing this
parameter (up to at most a very small multiple of the \s-1CPU\s0 core count) may
increase overall performance.
.IP "\fBudp_threads\fR" 4
.IX Item "udp_threads"
Exactly like \f(CW\*(C`tcp_threads\*(C'\fR, but for \s-1UDP\s0 sockets per \s-1DNS\s0 listening address.
.IP "\fBtcp_clients_per_thread\fR" 4
.IX Item "tcp_clients_per_thread"
Integer, default 256, min 16, max 65535.  This is maximum number of tcp \s-1DNS\s0
connections gdnsd will allow to occur in parallel per listening tcp thread.
When this limit is reached by a new incoming connection, the longest-idle of
the existing connections will be closed immediately in exchange for it.
.Sp
You can monitor the \f(CW\*(C`tcp.close_s_kill\*(C'\fR stat to see if such closes are
happening due to reaching the limit, which should be avoided if possible.  The
code is designed to be resilient (at least answer one legitimate request per
legitimate connection) even in the face of misbehaving (e.g. slow\-read/write)
connection overloads on Linux, and on BSDs with \f(CW\*(C`SO_ACCEPTFILTER\*(C'\fR and the
appropriate kernel modules (\f(CW\*(C`accf_dataready\*(C'\fR and/or \f(CW\*(C`accf_dns\*(C'\fR) loaded (there
will be a non-fatal error log output on startup if they aren't).
.Sp
Note that socket addresses map 1:m to threads (that is, each thread gets a
separate \f(CW\*(C`SO_REUSEPORT\*(C'\fR instantiation of a given logical socket), and thus the
total client limit for connecting to a given socket address would be
\&\f(CW\*(C`tcp_clients_per_thread * tcp_threads\*(C'\fR, but it's up to the operating system to
balance connections, and it may use simple connection tuple hashing or simple
round-robin, neither of which may guarantee very even distribution.
.IP "\fBtcp_timeout\fR" 4
.IX Item "tcp_timeout"
Integer seconds, default 37, min 5, max 1800.
.Sp
This determines the client-side idle timeout for \s-1TCP\s0 connections, which
is sent by the server to applicable clients supporting signalling mechanisms
like \s-1RFC 7828 EDNS TCP\s0 Keepalive or \s-1RFC 8490 DNS\s0 Stateful Operations (\s-1DSO\s0).
.Sp
There is a corresponding server-side timeout which determines when gdnsd will
give up on a client it believes to be delinquent (one that keeps a connection
open too long without honoring any signalled client-side idle timeout).  The
server-side timeout is double the client timeout (which equates to a default of
74, min 10, max 3600).
.Sp
Note that in the common/typical case of well-behaved clients and connections,
on a Linux server (where we use \s-1TCP_DEFER_ACCEPT\s0) or a \s-1BSD\s0 server supporting
the \*(L"dnsready\*(R" or \*(L"dataready\*(R" accept filters, when a new connection arrives we
immediately receive the first request and fire back the response without any
opportunity for delays that count as idle time, without re-entering the general
eventloop where idle time is processed or other new connections could arrive.
.Sp
The idleness of a client is only reset after it completes each full transaction
(send us a full request, and our full response makes it into at least the local
write buffer).  Inability to immediately write a full response into the
server's local \s-1TCP\s0 buffers (generally because the client has a too-small
receive window and/or is not ACKing several previous replies) causes immediate
connection termination.  Well-behaved client connections which don't stall out
midway through a transaction only become idle connections (subject to
termination for idleness) during inter-transaction idle periods after their
first transaction, and for not-so-well-behaved clients the idle timer helps
control the impact of patterns similar to slow\-read/write attacks.
.Sp
The server will send edns \s-1TCP\s0 keepalive information to clients with all
responses where it is legal (request used \s-1EDNS\s0 over \s-1TCP,\s0 and \s-1DSO\s0 is not yet
established).  The timeout value will be sent with the fixed value that is
configured here until the server begins shutting down, at which point the zero
value is sent in such responses in an attempt to get clients to cleanly close.
.Sp
Clients which establish \s-1DSO\s0 via the Keepalive \s-1TLV\s0 will get the same client-side
timeout sent to them as the \s-1DSO\s0 Inactivity timeout, with the \s-1DSO\s0 KeepAlive
interval set to Infinite (this means we don't request the client to ever send
artificial keepalive pings, and our client-side timeout applies to the interval
between real \s-1DNS\s0 request transactions in the session).  \s-1DSO\s0 clients will also
get better and more-timely information when the server is shutting down or
being replaced (we can push immediate \s-1DSO\s0 unidirectional messages towards them
asking that they close their session gracefully).
.IP "\fBdisable_tcp_dso\fR" 4
.IX Item "disable_tcp_dso"
Boolean, default false.  This disables \s-1RFC 8490 DNS\s0 Stateful Operations (\s-1DSO\s0)
support for \s-1TCP\s0 threads.
.Sp
Probably the only good reasons to disable would be finding interop issues or
misbehaviors in this new code and/or standard, as otherwise it offers a
superior mechanism for managing stateful client connections versus the previous
best available solution (\s-1RFC 7828 EDNS TCP\s0 Keepalive).
.IP "\fBtcp_backlog\fR" 4
.IX Item "tcp_backlog"
Integer, min 0, default 0, max 65535.  This sets the \f(CW\*(C`backlog\*(C'\fR argument of the
\&\f(CW\*(C`listen()\*(C'\fR call for \s-1TCP\s0 listening sockets.  The exact effects of this varies
by \s-1OS\s0 implementation, and it can also interact with features like
\&\f(CW\*(C`TCP_DEFER_ACCEPT\*(C'\fR and \f(CW\*(C`SO_ACCEPTFILTER\*(C'\fR.  If left at (or set to) the default
value of zero, the compile-time constant \f(CW\*(C`SOMAXCONN\*(C'\fR from the operating system
will be used, which tends to be reasonable for most use-cases.
.IP "\fBtcp_fastopen\fR" 4
.IX Item "tcp_fastopen"
Integer, default 256, min 0, max 1048576.  If set to a non-zero value, declares
a \s-1TCP\s0 Fastopen queue size and enables the feature.  \s-1TCP\s0 Fastopen allows clients
who have connected to the server at least once before to send initial data (in
our case, their first \s-1DNS\s0 request) at the same time as their initial \s-1SYN,\s0
shaving off the round trip delays of the handshake on reconnect.  This is
recommended, but may require OS-level support and/or configuration tuning, and
in the case of multiple servers behind a loadbalancer or anycast pool, may also
require administrative coordination of the server-side secret \s-1TFO\s0 key.
.IP "\fBtcp_proxy\fR" 4
.IX Item "tcp_proxy"
Boolean, default false.  This \s-1TCP\s0 option is \fBonly\fR supported inside the
per-address options of a specific listener address in the hash form of the
\&\f(CW\*(C`listen\*(C'\fR option, not as a global option.
.Sp
Addresses for which the option is enabled \fBonly\fR accept \s-1PROXY\s0 requests, cannot
use port number 53, do not spawn corresponding \s-1UDP\s0 listeners, and do not accept
UDP-related options.  We support both version 1 and 2 of the \s-1PROXY\s0 protocol as
defined in <https://www.haproxy.org/download/1.8/doc/proxy\-protocol.txt>, and
only accept TCPv4, TCPv6, and PROXYv2's \*(L"\s-1LOCAL\*(R".\s0
.Sp
The source \s-1IP\s0 passed to gdnsd over the \s-1PROXY\s0 protocol will be used as the
connection source address for all logical purposes, including e.g. GeoIP lookup
fallbacks in the absence of edns-client-subnet.  Once the initial \s-1PROXY\s0 header
is parsed successfully, the connection is treated exactly as any other \s-1TCP\s0
connection for the remainder of its life.
.Sp
It is not recommended to expose \s-1PROXY\s0 listeners to public traffic; they should
be confined to localhost or to addresses which are not reachable outside of
your infrastructure due to firewalling, etc.  This option is primarily intended
to test encrypted transports using external daemons proxying into gdnsd.  If
using it for some other generic loadbalancing without crypto, padding should be
disabled via \f(CW\*(C`tcp_pad\*(C'\fR below.
.Sp
\&\s-1PROXY\s0 connections increment all of the same stat counters as regular \s-1TCP\s0
connections, and also add two new proxy-specific ones:
.Sp
.Vb 6
\&    tcp.proxy: count of received connections on PROXY listeners (also
\&               increments the normal tcp.conns stat).
\&    tcp.proxy_fail: count of received PROXY connections which are
\&                    closed early for failing to send a PROXY header
\&                    the server parses and likes (also increments
\&                    tcp.close_s_err)
.Ve
.Sp
Example listen config:
.Sp
.Vb 7
\&      options => {
\&        listen => {
\&          0.0.0.0 => { ... } # normal UDP+TCP on port 53
\&          :: => { ... } # normal UDP+TCP on port 53 for IPv6
\&          127.0.0.1:53035 => { tcp_proxy => true, ... }
\&        }
\&      }
.Ve
.IP "\fBtcp_pad\fR" 4
.IX Item "tcp_pad"
Boolean, default false for normal \s-1TCP\s0 listeners, default true for \f(CW\*(C`tcp_proxy\*(C'\fR
listeners (see above).  This \s-1TCP\s0 option is \fBonly\fR supported inside the
per-address options of a specific listener address in the hash form of the
\&\f(CW\*(C`listen\*(C'\fR option, not as a global option.
.Sp
If enabled (by default for the \f(CW\*(C`tcp_proxy\*(C'\fR case), a response to any request
which carries an \s-1EDNS OPT RR\s0 will be padded using the \s-1EDNS\s0 Padding option to a
multiple of 468 bytes as recommended in \s-1RFC 8467.\s0  This should only be enabled
if the \s-1TCP\s0 connections to a listener are encrypted by a proxy, which is the
intended use-case for \f(CW\*(C`tcp_proxy\*(C'\fR above.  You may wish to enable this manually
if proxying encrypted requests via a daemon that doesn't do the \s-1PROXY\s0 protocol,
and you may wish to disable it on \f(CW\*(C`tcp_proxy\*(C'\fR listeners if the other daemon
isn't providing a crypto wrapper.
.IP "\fBudp_rcvbuf\fR" 4
.IX Item "udp_rcvbuf"
Integer, min 4096, max 1048576, default 0.  If set to a non-zero value, this
value will be used to set the \f(CW\*(C`SO_RCVBUF\*(C'\fR socket option on the \s-1UDP\s0 listening
socket(s), otherwise we leave the \s-1OS\s0 defaults alone.
.IP "\fBudp_sndbuf\fR" 4
.IX Item "udp_sndbuf"
Integer, min 4096, max 1048576, default 0.  If set to a non-zero value, this
value will be used to set the \f(CW\*(C`SO_SNDBUF\*(C'\fR socket option on the \s-1UDP\s0 listening
socket(s), otherwise we leave the \s-1OS\s0 defaults alone.
.IP "\fBtcp_control\fR" 4
.IX Item "tcp_control"
\&\fB\s-1DANGER\s0\fR \- Exposing the control socket over \s-1TCP\s0 is dangerous.  The control
socket server code is not designed to be robust against arbitrary attack
traffic, and does not have any authentication or encryption.  Listen addresses
defined here should be well-protected and confined by network firewall policies
to internal, privileged clients, and should \fBdefinitely\fR not be exposed on the
public Internet.
.Sp
This specifies one or more secondary \s-1TCP\s0 listen addresses for control socket
connections (alongside the required primary \s-1UNIX\s0 domain socket), which must be
explicitly configured if desired.  It is similar to \fBlisten\fR above in that it
accepts either a single address spec, an array of address specs, or a hash
whose keys are address specs and whose values are address-specific options.
All address specs must include an explicit address and non-zero port number.
.Sp
The only two address-specific options are \f(CW\*(C`chal_ok\*(C'\fR and \f(CW\*(C`ctl_ok\*(C'\fR, which are
booleans defaulting to false.  By default, a \s-1TCP\s0 control socket is restricted
to read-only operations (\f(CW\*(C`gdnsdctl status\*(C'\fR, \f(CW\*(C`gdnsdctl stats\*(C'\fR, and
\&\f(CW\*(C`gdnsdctl states\*(C'\fR).  \f(CW\*(C`chal_ok\*(C'\fR allows \s-1ACME\s0 Challenge operations on the socket
(\f(CW\*(C`gdnsdctl acme\-dns\-01\*(C'\fR and \f(CW\*(C`gdnsdctl acme\-dns\-01\-flush\*(C'\fR).  \f(CW\*(C`ctl_ok\*(C'\fR allows
daemon control commands on the socket (\f(CW\*(C`gdnsdctl reload\-zones\*(C'\fR and \f(CW\*(C`gdnsdctl
replace\*(C'\fR).  The \f(CW\*(C`gdnsdctl stop\*(C'\fR command isn't allowed over \s-1TCP\s0 at all.
.Sp
The standard unix control socket is also used for some inter-daemon
coordination and resource handoff during replacements, which cannot be
supported over the \s-1TCP\s0 variant.
.Sp
Examples:
.Sp
.Vb 1
\&    options => { tcp_control => 127.0.0.1:885 } # read\-only ops only
\&
\&    options => { tcp_control => [ 127.0.0.1:885, 127.0.0.2:885 ] } # ditto
\&
\&    options => { tcp_control => {
\&        127.0.0.1:885 => {} # readonly
\&        127.0.0.1:886 => { chal_ok => true } # allows challenge stuff
\&        127.0.0.1:887 => { ctl_ok => true } # allows daemon control
\&        127.0.0.1:888 => { chal_ok => true, ctl_ok => true } # allows both
\&    }}
.Ve
.Sp
The \f(CW\*(C`gdnsdctl\*(C'\fR client has an option \f(CW\*(C`\-s\*(C'\fR for specifying a \s-1TCP\s0 socket to
connect to for use with \f(CW\*(C`tcp_control\*(C'\fR sockets, in which case it does not even
attempt to parse the server configuration to find the normal unix socket path.
.IP "\fBzones_strict_data\fR" 4
.IX Item "zones_strict_data"
Boolean, default \f(CW\*(C`false\*(C'\fR
.Sp
If false (the default), reporting of many less-serious errors in zone
data are emitted as mere logged warnings, and the zone data is still
loaded and served.
.Sp
If this is set to true, such warnings will be upgraded and treated
the same as the more-serious class of zone data errors which prevent
successful loading of zone data.
.IP "\fBzones_rfc1035_threads\fR" 4
.IX Item "zones_rfc1035_threads"
Integer, default 2, min 1, max 1024.  When the standard \s-1RFC1035\s0 zone files are
(re\-)loaded, up to this many ephemeral threads will be spawned in parallel to
help load and parse them faster.
.Sp
The way the work is divided among the threads is relatively naive: As the zones
directory on the filesystem is scanned for zone filenames, the names are
divided evenly into N separate work lists (one per thread), and then the
threads are all spawned and work on their own fixed lists in parallel, with the
final splicing of the zone data into the root tree happening serially in the
main zones thread as each worker thread finishes.  In the case that the total
count of zonefiles is less than the configured thread count, the excess threads
are not spawned.
.Sp
This simple strategy tends to work well for large counts of zonefiles where the
per-zonefile parsing costs are roughly even, but in cases where a minority of
zonefiles take much longer to parse than others, it will not always result in a
very \*(L"fair\*(R" outcome (some threads may run much longer than others).
.Sp
Note that in general, improving the I/O performance of reading the zonefiles
from disk (e.g. put them on an \s-1SSD\s0) tends to help more than the parallelization
here does, although both together is even better!
.IP "\fBlock_mem\fR" 4
.IX Item "lock_mem"
Boolean, default false.  Causes the daemon to do
\&\f(CW\*(C`mlockall(MCL_CURRENT|MCL_FUTURE)\*(C'\fR, which effectively locks all daemon
memory into \s-1RAM,\s0 unable to be swapped.  Possibly helpful in some
production cases to ensure swap-in doesn't affect \s-1DNS\s0 latency.
.Sp
You'll need to ensure the ulimit for locked memory is sufficient large (e.g.
\&\*(L"infinity\*(R") to avoid process death.
.IP "\fBdisable_text_autosplit\fR" 4
.IX Item "disable_text_autosplit"
Boolean, default false.  On the wire, \f(CW\*(C`TXT\*(C'\fR records are encoded as
discrete chunks of up to 255 characters per chunk.  The relevant RFCs
state that multiple chunks should be treated by clients as if they are
concatenated.  That is to say, it should make no difference to a client
whether the \f(CW\*(C`TXT\*(C'\fR data is sent as two 16\-byte chunks or one 32\-byte
chunk.
.Sp
Ordinarily, you may specify chunk(s) of a \f(CW\*(C`TXT\*(C'\fR record in gdnsd
zonefiles as a string of any size up to the legal length (just short of
16K in practice), and gdnsd will auto-split the data into 255\-byte
chunks for transmission over the \s-1DNS\s0 protocol correctly.  If you choose
to manually break up your \s-1TXT\s0 record into multiple strings in the
zonefile, gdnsd also honors these boundaries and will not attempt to
merge them into larger chunks where possible.
.Sp
If you set this option to true, the auto-splitting behavior is
disabled, and any single character string specified in a zonefile as
part of a \f(CW\*(C`TXT\*(C'\fR record which is larger than 255 bytes will
be considered a syntax error.
.IP "\fBmax_edns_response\fR" 4
.IX Item "max_edns_response"
Integer, default 1232, min 512, max 16384.  This is the maximum size
of a \s-1UDP\s0 edns response to a client over IPv4, acting as a cap on
the edns buffer size advertised by the client in its request.
.Sp
It is recommended that you do not raise this value from the default for
a server facing the public Internet.
.Sp
Setting this in the ~4\-16K range might be desirable if you have large
response RR-sets and are willing to tolerate some fragmentation,
especially in a private network where a larger path \s-1MTU\s0 (e.g. ~9K for
ethernet jumbo frames) can be guaranteed.
.Sp
The option obviously has no pragmatic effect if you do not have
large response datasets in your zones in the first place.
.IP "\fBmax_edns_response_v6\fR" 4
.IX Item "max_edns_response_v6"
Integer, default 1232, min 512, max 16384.
.Sp
As above for \s-1UDP\s0 edns responses over IPv6.  Once again, raising this
above its default value is not recommended for a public-facing server.
.IP "\fBedns_client_subnet\fR" 4
.IX Item "edns_client_subnet"
Boolean, default true.  Enables support for the edns-client-subnet
option from \s-1RFC 7871.\s0  gdnsd only includes this \s-1EDNS\s0 option in responses
to queries which also contained the option.  In the case of normal
responses from static zone data, the scope mask will be set to zero.
Dynamic response plugins have access to the query's \s-1EDNS\s0 client-subnet
data, and have full control over the response scope mask.
.Sp
If the option is set to false, gdnsd will ignore the option in queries,
never set it in its responses, and plugins will not have access to any
data provided by any ignored edns-client-subnet option in queries.
.Sp
Of the included standard plugins only \f(CW\*(C`reflect\*(C'\fR and \f(CW\*(C`geoip\*(C'\fR make use
of edns-client-subnet information.  The rest will leave the scope mask
at zero as normal for client-location-agnostic static data.
.IP "\fBchaos_response\fR" 4
.IX Item "chaos_response"
String, default \*(L"gdnsd\*(R".  When gdnsd receives any query with the class
\&\f(CW\*(C`CH\*(C'\fR (\*(L"Chaos\*(R"), as opposed to the normal \f(CW\*(C`IN\*(C'\fR (\*(L"Internet\*(R"), it will
return a single response record of class \f(CW\*(C`CH\*(C'\fR and type \f(CW\*(C`TXT\*(C'\fR, which
contains the string defined here.  This is something like \s-1BIND\s0's
version reporting, which responds to \*(L"version.bind\*(R" queries in the
\&\f(CW\*(C`CH\*(C'\fR class, and is what a client will see if they use such a query
against a gdnsd server.
.IP "\fBacme_challenge_ttl\fR" 4
.IX Item "acme_challenge_ttl"
Integer seconds, range 60\-3600, default 600.  For temporary \s-1ACME DNS\-01\s0
challenge data added via \f(CW\*(C`gdnsdctl acme\-dns\-01 ...\*(C'\fR, this sets the time
until the \s-1TXT\s0 records auto-expire from the server and disappear.
.Sp
See the \fBgdnsdctl\fR\|(8) documentation about \f(CW\*(C`acme\-dns\-01\*(C'\fR for more details.
.IP "\fBacme_challenge_dns_ttl\fR" 4
.IX Item "acme_challenge_dns_ttl"
Integer seconds, range 0\-3600, default 0.  For temporary \s-1ACME DNS\-01\s0
challenge data added via \f(CW\*(C`gdnsdctl acme\-dns\-01 ...\*(C'\fR, this sets the \s-1DNS TTL\s0
value which is used in response \s-1TXT\s0 RRs.
.Sp
In previous versions, the \s-1DNS TTL\s0 value mirrored the expiry \s-1TTL\s0 from
\&\f(CW\*(C`acme_challenge_ttl\*(C'\fR above.  However, this (non-zero \s-1DNS\s0 TTLs for these
records in general) has lead to confusing issues in the real world with \s-1ACME\s0
servers under certain conditions.
.Sp
Note that static zonefile RRs with \f(CW\*(C`_acme\-challenge\*(C'\fR as their leading label
are also forced to this \s-1TTL\s0 regardless of the zonefile-level explicit \s-1TTL,\s0
to avoid cases of mixed TTLs when mixing static and dynamic records in
server outputs.
.IP "\fBnsid\fR" 4
.IX Item "nsid"
String, no default, 2\-256 chars in length.  Character count must be
even, and all characters must be \s-1ASCII\s0 hex digits.  This encodes up to
128 bytes of arbitrary binary data chosen by the administrator and
serves it in the \s-1EDNS NSID\s0 (\s-1RFC 5001\s0) option data of all response
packets.  The \s-1NSID\s0 is obviously not emitted to clients unless they
request it via \s-1EDNS,\s0 and is not emitted at all unless this option
is specified explicitly.  This is intended to help with the
identification of specific servers when multiple servers are part
of an anycast or loadbalancer pool.
.IP "\fBnsid_ascii\fR" 4
.IX Item "nsid_ascii"
String, no default, 1\-128 chars of printable \s-1ASCII\s0 characters.
This is an convenience alternative to \f(CW\*(C`nsid\*(C'\fR above, allowing the binary \s-1NSID\s0
data to be configured with the bytes of a printable \s-1ASCII\s0 string up to 128
bytes in length.  Only one of \f(CW\*(C`nsid\*(C'\fR or \f(CW\*(C`nsid_ascii\*(C'\fR may be specified.
.IP "\fBexperimental_no_chain\fR" 4
.IX Item "experimental_no_chain"
Boolean, default true.
.Sp
If set to true (the default), when a query for any \s-1RR\s0 type encounters a
\&\f(CW\*(C`CNAME\*(C'\fR \s-1RR\s0 in the zone data, the behavior of the server will be as if the
queried type was \f(CW\*(C`CNAME\*(C'\fR.  This implies no chasing of the target
(right-hand-side) name to emit any further answer-section records or
delegations related to the target, even if they exist in the local data of the
same zone.
.Sp
This option is likely to become the fixed behavior (no option to disable) in a
future release.  If this new default behavior causes a problem, you can (for
now!) set the option to false to revert to the traditional behavior of emitting
chained multi-RR responses for zone-local CNAMEs as a workaround.  Please file
a bug report if so, otherwise we'll have no feedback to go on!
.Sp
This behavior is desirable for a few reasons:
.Sp
\&\s-1RFC 7871\s0 (edns-client-subnet) actually recommends it for at least subnet
differentiated responses, because otherwise it's ambiguous which of the
multiple answer-section records the subnet scoping applies to, and caches
invariably have to take a pessimistic view and subnet-fragment cache entries
pointlessly.  This is the most-compelling rationale, and it has impact on what
kind of efficient geodns setups can work at all for certain use-cases.
.Sp
It also adheres to the general principle of minimal responses we adhere to
elsewhere (caches may have the target cached already anyways), and it helps
minimize response sizes (reduce reflection, and esp helpful for \s-1DNSSEC\s0 in the
future).
.Sp
Also, if this were the fixed behavior of the server, rather than configurable,
it would significantly simplify the code and make lookups more efficient (these
gains are not realized by the experimental optional version).
.Sp
However, it's also RFC-questionable.  The original \s-1RFC1034\s0 algorithms ask that
authoritative servers complete local \s-1CNAME\s0 chains from local data (which this
violates), but also requires recursors to complete them remotely (which makes
this work, and which most do now, but historically some older implementations
implicitly relied on the authserver doing it).  \s-1RFC 2308\s0 also touches on this
topic, and the \s-1TL\s0;DR there is that recursors can tell our incomplete responses
from actual negative \*(L"No Data\*(R" responses about the next name in the chain by
the fact that we don't emit an \s-1SOA\s0 record in the auth section.
.Sp
Update 2020\-11: this has now been tested pretty widely on the Internet (by a
major site with a global audience of millions), for a very long time (nearly
two years), and there has been no evidence so far of breakage or failure
reports from real users.
.IP "\fBdisable_cookies\fR" 4
.IX Item "disable_cookies"
Boolean, default false.  Disables support for \s-1RFC 7873 EDNS\s0 Cookies.  Not
recommended, as these cookies provide a layer of defense against both off-path
response forgery and amplification attacks.  One possible legitimate reason to
disable cookies would be if gdnsd is operating in a mixed set of
loadbalanced/anycasted auth servers and some of the other servers do not
support cookies, or use different algorithms than gdnsd.  Our cookie support is
fairly efficient; there shouldn't be any major performance reason to disable
it.
.IP "\fBmax_nocookie_response\fR" 4
.IX Item "max_nocookie_response"
Integer bytes, default zero (disabled), range 128\-1024.  If this parameter is
set to a non-zero value, all \s-1UDP\s0 responses will be limited to this many bytes
unless the query presents a valid \s-1EDNS\s0 Cookie that the server recognizes as its
own.  Responses which fail this check (\s-1UDP\s0 with no valid cookie and larger than
this length) will be truncated fully (no response RRs) and the TC-bit will be
set, asking the client to retry over \s-1TCP.\s0
.Sp
This is intended to limit the ability of attackers to use your server as a
reflection source for amplification attacks, as valid cookies give some
reasonable guarantee that the query packet source address wasn't forged.  It
\&\fBshould\fR be pretty safe to set this at least as low as 512, and that may
become the default setting in some future version.
.IP "\fBcookie_key_file\fR" 4
.IX Item "cookie_key_file"
String, default undefined.  When this is defined, the file's contents are read
as the persistent primary key value for generating \s-1EDNS\s0 Cookie responses.
.Sp
If the file exists, it must be readable by the daemon, and it must contain 32
bytes of binary data.  Failure to properly read a key file defined here is
fatal at startup.  Permissions should be set with care, so that other
unprivileged users of the system cannot read the key.
.Sp
Note that the contents are considered binary data and are used \fBdirectly\fR as
secret key input to crypto algorithms, and thus they should be generated
securely with high entropy and indistinguishable from random bytes.  It is
recommended the file's contents be generated with an \s-1RNG\s0 outputting 32 random
binary bytes, e.g.: \f(CW\*(C`dd if=/dev/urandom of=cookie.key bs=32 count=1\*(C'\fR.
.Sp
The keyfile's contents don't have to be changed on any sort of fixed or
frequent schedule to maintain security.  Treat it like any other long-term
secret value and make new ones once in a blue moon just out of an abundance of
caution, or if you believe the previous key material may be compromised.  The
daemon must be replaced or restarted to put the new key into effect, and this
will abruptly invalidate outstanding cookies clients may be holding that were
generated with previous keys.
.Sp
The primary reason to define \f(CW\*(C`cookie_key_file\*(C'\fR to your own pathname and key
contents is to have synchronized cookie keys across an anycasted or otherwise
loadbalanced set of servers, so that they all agree on server cookies.
.Sp
If this file is not defined, then the daemon manages the cookie primary key
value automatically.  Under automatic management of the key, it will attempt to
read a key from \fI/tmp/gbc/bin/gdnsd/var/run/gdnsd/cookie.autokey\fR at startup.  If that
doesn't work, it will generate a new random key in memory and attempt to write
it to the same path for consumption by future daemons.  If both reading an old
automatic key and writing the new one fail, a non-fatal error will be logged,
and the new randomly-generated key exists only in daemon memory and will not
persist across future daemon replace or restart cycles.
.Sp
Note that in common Linux/systemd installations, the run directory will be
wiped on \s-1OS\s0 reboots and a fresh key will be generated on the next daemon
startup.  As with a manually-defined \f(CW\*(C`cookie_key_file\*(C'\fR, any time the automatic
key must be regenerated, this will invalidate all outstanding server cookies
held by clients.
.IP "\fBrun_dir\fR" 4
.IX Item "run_dir"
String, defaults to \fI/tmp/gbc/bin/gdnsd/var/run/gdnsd\fR.  This is the directory which the
daemon owns as its run directory.
.Sp
It will create this directory or modify the permissions of an existng one on
startup.  If it does not exist and cannot be created, or the permissions cannot
be set to acceptable values (possibly because the existing directory is owned
by a different uid than the daemon is currently running as), the daemon will
not start.
.Sp
The contents of this directory are private to the daemon and
shouldn't be interfered with.  This can live on a filesystem that's
volatile across reboots, and doesn't require much disk space.
.Sp
The daemon's control socket and lock files live here.
.IP "\fBstate_dir\fR" 4
.IX Item "state_dir"
String, defaults to \fI/tmp/gbc/bin/gdnsd/var/lib/gdnsd\fR.  This is the directory
which the daemon owns as its state directory.
.Sp
It will create this directory if necessary at startup.  If it does not exist
and cannot be created, the daemon will not start.
.Sp
The contents of this directory belong to the system administrator
and are used to communicate persistent, stateful information to
the daemon.  This should live on a filesystem which is preserved
across reboots.
.Sp
The \fIadmin_state\fR file lives here.
.SH "SERVICE_TYPES"
.IX Header "SERVICE_TYPES"
service_types is used in conjunction with certain gdnsd plugins.  If
you are not using such a plugin, you can safely ignore this section and
omit it from your configuration.
.PP
The service_types hash contains generic definitions for how to monitor
a given types of service, independently of any specific address or
hostname for that service.
.PP
There are two trivial service_types internally defined as the names
\&\f(CW\*(C`up\*(C'\fR and \f(CW\*(C`down\*(C'\fR, which do no actual monitoring and simply set the
monitored state permanently \f(CW\*(C`UP\*(C'\fR or \f(CW\*(C`DOWN\*(C'\fR.  \f(CW\*(C`up\*(C'\fR is the default
service_type when no service_type is specified.
.PP
Within the definition of a service_type there are several generic
parameters related to timing and anti-flap, as well as plugin-specific
parameters that vary per plugin.
.PP
A service type does not, however, specify a name or address for a
specific instance of a service.  Those would occur on a per-address
basis in a resolving plugin's configuration down in the \f(CW\*(C`plugins\*(C'\fR
stanza, and the plugin's configuration would then reference a named
service type to be used when monitoring said address.
.PP
A service monitored through these mechanisms is always in either the
\&\f(CW\*(C`UP\*(C'\fR or \f(CW\*(C`DOWN\*(C'\fR state at runtime from a monitoring perspective.  The
\&\f(CW\*(C`UP\*(C'\fR state is maintained in the face of intermittent or isolated failures
until the anti-flap thresholds are crossed and the state moves to
\&\f(CW\*(C`DOWN\*(C'\fR.
.PP
Any services monitored for plugins also have their state reported
alongside the standard gdnsd statistics report, served by the built-in
\&\s-1HTTP\s0 server (default port is 3506).
.PP
The following are the generic parameters for all service_types:
.IP "\fBup_thresh\fR" 4
.IX Item "up_thresh"
Integer, default 20, min 1, max 65535.  Number of monitoring requests
which must succeed in a row without any failures to transition
a given resource from the \f(CW\*(C`DOWN\*(C'\fR state to the \f(CW\*(C`UP\*(C'\fR state.
.IP "\fBok_thresh\fR" 4
.IX Item "ok_thresh"
Integer, default 10, min 1, max 65535.  See below.
.IP "\fBdown_thresh\fR" 4
.IX Item "down_thresh"
Integer, default 10, min 1, max 65535.  The \f(CW\*(C`ok_thresh\*(C'\fR and \f(CW\*(C`down_thresh\*(C'\fR
parameters control the transition from the \f(CW\*(C`UP\*(C'\fR state to the \f(CW\*(C`DOWN\*(C'\fR
state while trying to prevent flappy behavior.  Their behavior is best
described in terms of an internal failure counter for a resource
which is currently in the \f(CW\*(C`UP\*(C'\fR state.  The failure counter starts
at zero on state transition into the \f(CW\*(C`UP\*(C'\fR state.
.Sp
Every state poll that results in a failed response, even if other
successful responses are interleaved between them, increments the
failure counter.  If the failure counter reaches \f(CW\*(C`down_thresh\*(C'\fR
the resource is transitioned to the \f(CW\*(C`DOWN\*(C'\fR state.  However, if
\&\f(CW\*(C`ok_thresh\*(C'\fR successes occur in a row with no failures between them,
the failure counter is reset back to zero.
.Sp
So with the default values, the expected behavior is that if an \f(CW\*(C`UP\*(C'\fR
resource experiences 10 (possibly isolated or intermittent)
monitor-polling failures over \fBany\fR length of time, without a
string of 10 successes in a row somewhere within the sequence to
reset the counter, it will transition to the \f(CW\*(C`DOWN\*(C'\fR state.
Once \f(CW\*(C`DOWN\*(C'\fR, it will require 20 successes in a row before
transitioning back to the \f(CW\*(C`UP\*(C'\fR state.
.IP "\fBinterval\fR" 4
.IX Item "interval"
Integer seconds, default 10, min 1, max 255.  Number of seconds between
successive monitoring requests for a given resource.
.IP "\fBtimeout\fR" 4
.IX Item "timeout"
Integer seconds, default interval/2, min 1, max 255.  Maximum time the
monitoring code will wait for a successful response before giving up
and considering the request to be a failure.  Defaults to half of the
\&\f(CW\*(C`interval\*(C'\fR, and must be less than \f(CW\*(C`interval\*(C'\fR.
.IP "\fBplugin\fR" 4
.IX Item "plugin"
String, required.  This indicates which specific plugin to use to execute
the monitoring requests.  Any parameters other than the generic ones listed
here are consumed by the plugin.
.PP
There are six monitoring plugins included with gdnsd that can be used
in a service_types definition, each of which may have additional,
plugin-specific configuration options in addition to the generic ones
above.  Each of these is documented in detail in its own manpage
e.g. \f(CW\*(C`gdnsd\-plugin\-FOO\*(C'\fR:
.IP "\fBtcp_connect\fR" 4
.IX Item "tcp_connect"
Checks \s-1TCP\s0 basic connectivity on a given port.  Only supports
address resources, not CNAMEs.
.IP "\fBhttp_status\fR" 4
.IX Item "http_status"
Checks \s-1HTTP\s0 connectivity, with options for the port, \s-1URL,\s0 and vhost
to use in the request, and the acceptable \s-1HTTP\s0 status codes in
the response.  Only supports address resources, not CNAMEs.
.IP "\fBextmon\fR" 4
.IX Item "extmon"
Periodically executes a custom external commandline program
to poll for the status of a resource.  Supports both address
and \s-1CNAME\s0 resources.
.IP "\fBextfile\fR" 4
.IX Item "extfile"
Reads the contents of a file on disk to import state monitoring data
from another source.  Supports both address and \s-1CNAME\s0 resources.
.IP "\fBstatic\fR" 4
.IX Item "static"
Configures a static monitoring result, mostly for testing / example code.
Supports both address and \s-1CNAME\s0 resources.
.IP "\fBnull\fR" 4
.IX Item "null"
Configures an always-down static result, mostly for testing / example code.
Supports both address and \s-1CNAME\s0 resources.
.SH "PLUGINS"
.IX Header "PLUGINS"
The plugins hash is optional, and contains one key for every dynamic
resolution plugin you wish to load and use.  The value must be a hash,
and the contents of that hash are supplied to the plugin to use in
configuring itself.  If the plugin requires no configuration, the empty
hash \f(CW\*(C`{}\*(C'\fR will suffice.  It is up to the plugin to determine whether
the supplied hash of configuration data is legal or not.
.PP
Monitoring-only plugins can also be given plugin-global level
configuration here if the plugin author deemed it necessary.
.PP
gdnsd ships with eight different monitoring plugins,
all of which have their own separate manpage documentation (e.g. \f(CW\*(C`man
gdnsd\-plugin\-FOO\*(C'\fR):
.IP "\fBreflect\fR" 4
.IX Item "reflect"
Reflects \s-1DNS\s0 client source \s-1IP\s0 and/or edns-client-subnet information
back to the requestor as address data for debugging.
.IP "\fBsimplefo\fR" 4
.IX Item "simplefo"
Simple primary\->secondary failover of monitored addresses
.IP "\fBmultifo\fR" 4
.IX Item "multifo"
All-active failover of monitored round-robin address groups
.IP "\fBweighted\fR" 4
.IX Item "weighted"
Weighted-round-robin responses with a variety of behavioral flavors,
for both monitored addresses and CNAMEs.
.IP "\fBmetafo\fR" 4
.IX Item "metafo"
Static-ordered address(\-group) meta-failover between 'datacenters',
which are resources defined in terms of other plugins.  Supports
both address and \s-1CNAME\s0 data.
.IP "\fBgeoip\fR" 4
.IX Item "geoip"
Combines metafo's functionality with MaxMind GeoIP databases to select
different datacenter address(\-group) preference/failover orderings for
different clients based on approximate geographic location.  Supports
both address and \s-1CNAME\s0 data.
.IP "\fBnull\fR" 4
.IX Item "null"
Returns all-zeros addresses or the \s-1CNAME\s0 \f(CW\*(C`invalid.\*(C'\fR \- mostly for
testing and as simple example code.
.IP "\fBstatic\fR" 4
.IX Item "static"
Configures static mappings of resources names to \s-1IP\s0 addresses or
CNAMEs \- mostly for testing and as simple example code.
.PP
A configuration example showing the trivial plugins, as well as
demonstrating the service_types described earlier:
.PP
.Vb 9
\&  service_types => {
\&    corpwww_type => {
\&      plugin => http_status
\&      vhost => www.corp.example.com
\&      url_path => /check_me
\&      down_thresh => 5
\&      interval => 5
\&    }
\&  }
\&
\&  plugins => {
\&    null => {},
\&    reflect => {},
\&    static => {
\&      foo = 192.0.2.2
\&      bar = 192.0.2.123
\&      somehost = somehost.example.net.
\&    },
\&    multifo => {
\&      web\-lb =>
\&        service_types => [ corpwww_type, xmpp ],
\&        lb01 => 192.0.2.200,
\&        lb02 => 192.0.2.201,
\&        lb03 => 192.0.2.202,
\&      }
\&    }
\&  }
.Ve
.PP
And then in your example.com zonefile, you could have (among your other
RRs):
.PP
.Vb 6
\&  zeros 600 DYNA null
\&  reflect 10 DYNA reflect
\&  reflect\-both 10 DYNA reflect!both
\&  pointless 42 DYNA static!foo
\&  acname 400 DYNC static!somehost
\&  www 300/45 DYNA multifo!web\-lb
.Ve
.SH "LOW-LEVEL SYNTAX"
.IX Header "LOW-LEVEL SYNTAX"
At the lowest level, the syntax of gdnsd config files roughly resembles
an anonymous Perl data structure (using reference syntax).  There are
three basic data types for values: ordered hashes (associative arrays
mapping keys to values), ordered arrays of values, and simple strings.
Hashes and arrays can be nested to arbitrary depth.  Generally
speaking, whitespace is optional.  Single-line comments in both shell
(\f(CW\*(C`#\*(C'\fR) and \s-1DNS\s0 zonefile styles (\f(CW\*(C`;\*(C'\fR) are allowed.  They run to the end
of the current line and are considered to be whitespace by the parser.
.PP
A hash is surrounded by curly braces (\f(CW\*(C`{\*(C'\fR and \f(CW\*(C`}\*(C'\fR).  Keys are
separated from their values by either \f(CW\*(C`=>\*(C'\fR or \f(CW\*(C`=\*(C'\fR (at your
stylistic discretion).  Hash keys follow the same rules as simple
string values.  Hash values can be simple strings, arrays, or hashes.
Key/value pairs can optionally have a trailing comma for stylistic
clarity and separation.
.PP
An array is surrounded by square braces (\f(CW\*(C`[\*(C'\fR and \f(CW\*(C`]\*(C'\fR).  Values can be
simple strings, arrays, or hashes.  Values can optionally have a
trailing comma for style.
.PP
Strings (and thus keys) can be written in both quoted and unquoted
forms.  In the quoted form, the string is surrounded by double-quotes
(\f(CW\*(C`"\*(C'\fR), and can contain any literal byte value (even binary/utf\-8
stuff, or \s-1NUL\s0) other than \f(CW\*(C`"\*(C'\fR or \f(CW\*(C`\e\*(C'\fR.  Those two characters must be
escaped by \f(CW\*(C`\e\*(C'\fR, i.e.  \f(CW\*(C`\e"\*(C'\fR and \f(CW\*(C`\e\e\*(C'\fR.
.PP
In the unquoted form, there are no surrounding quotes, and the allowed
set of unescaped characters is further restricted.  The following are
not allowed: \f(CW\*(C`][}{;#,"=\e\*(C'\fR (that is, square brackets, curly brackets,
semicolons, octothorpes, commas, double quotes, equal signs, and
backslashes).  Additionally, the first character cannot be a \f(CW\*(C`$\*(C'\fR
(dollar sign).
.PP
Both forms use the same escaping rules, which are the same RFC-standard
escaping rules used in zone files.  The escapes always start with \f(CW\*(C`\e\*(C'\fR.
\&\f(CW\*(C`\e\*(C'\fR followed by any single byte other than a digit (\f(CW0\fR \- \f(CW9\fR) is
interepreted as that byte.  \f(CW\*(C`\e\*(C'\fR followed by exactly 3 digits
interprets those digits as the unsigned decimal integer value of the
desired byte (the 3 digit value cannot exceed \f(CW255\fR).
.PP
To illustrate the escaping and quoting, the following sets of example
strings show different encodings of the same parsed value:
.PP
.Vb 4
\&  example
\&  "example"
\&  ex\e097mpl\ee
\&  "ex\e097mpl\ee"
\&
\&  internal\e"doublequote
\&  "internal\e"doublequote"
\&
\&  white\e space
\&  "white space"
\&
\&  "braces{every[where]oh}my"
\&  braces\e{every\e[where\e]oh\e}my
\&
\&  "\e\e==="
\&  "\e092==="
\&  "\e092\e=\e=\e="
\&  \e\e\e=\e=\e=
\&  \e092\e=\e=\e=
.Ve
.PP
The top level of the config file is an implicit hash with no bracing
by default, but can also be an array bounded by square brackets.  This
is not legal for the primary gdnsd configuration file, but could be
useful in includefiles (see below).
.PP
As a general rule, anywhere the higher-level syntax allows an array of
values, you can substitute a single value.  The code will treat it as
if it were an array of length 1.
.PP
When we refer in other sections above to a value as being an \*(L"Integer\*(R"
(or other specific scalar type), we're referring to constraints on the
content of the character string value.  All scalar values are character
strings.  \*(L"Boolean\*(R" values are characters strings which have the value
\&\*(L"true\*(R" or \*(L"false\*(R", in any mix of upper or lower case.
.PP
The following 3 example configuration files are identical in their
parsed meanings, and should clarify anything miscommunicated above:
.PP
Example 1 (simple and clean):
.PP
.Vb 3
\&  options = {
\&    listen = [ 192.0.2.1, 192.0.2.2 ],
\&  }
.Ve
.PP
Example 2 (fat arrows, no commas, some arbitrary quoting):
.PP
.Vb 3
\&  "options" => {
\&    listen => [ 192.0.2.1 192.0.2.2 ]
\&  }
.Ve
.PP
Example 3 (compressed and ugly):
.PP
.Vb 1
\&  options={listen=[192.0.2.1 192.0.2.2]}
.Ve
.SH "INCLUDING OTHER FILES"
.IX Header "INCLUDING OTHER FILES"
vscf now has a mechanism for config includefiles.  The syntax is
.PP
.Vb 3
\&  $include{dir/file} # single file must exist
\&  $include{dir/*}   # not ok if no matching files
\&  $include{dir}     # ok if no files in dir
.Ve
.PP
where the path can use the same kinds of escaping and/or double-quoting
as normal scalar string data.  Whitespace between the path and the
surrounding brackets is optional.  Whitespace between \f(CW$include\fR and
the following \f(CW\*(C`{\*(C'\fR is not allowed.  If the path is relative (does not
begin with \fI/\fR), it is interpreted as relative to the directory
containing the parent file.  Includes can nest other includes to
arbitrary depth.
.PP
The path is normally treated as a glob, allowing the inclusion of
multiple files.  When used as a glob, there must be at least one match \-
it will be an error if there are no matching files.  However, if \f(CW\*(C`path\*(C'\fR
is not a glob and names an \fBexisting\fR directory explicitly, it will be
treated like it was a glob of all files within that directory by
appending \f(CW\*(C`/*\*(C'\fR, and it will not be an error if there are no files
within that directory (no matches for the glob).
.PP
Keep in mind that at the top level of any given vscf file (even
include files), the file must syntactically be either an implicit
hash or an explicit, square-bracket-bounded, array.
.PP
The include statement can be used in two distinct contexts within
the syntax structure of a config file:
.IP "\fBValue Context\fR" 4
.IX Item "Value Context"
The include statement can replace any whole value (that is, the right
hand side of a hash map entry or a member of an array) with its own
contents, which are either a hash or an array.  Note that there is no
mechanism for flattening an include-file's array into the parent array
(the whole included array would be a single array item within the parent
array).  Also, including multiple files in a single statement (directory
name or glob pattern) are not allowed in value context.  Examples:
.Sp
.Vb 4
\&  main config:
\&    options => { listen => $include{foo} }
\&  foo:
\&    [ 127.0.0.1, 127.0.0.2 ]
\&
\&  main config:
\&    plugins => $include{ "bar" }
\&  bar:
\&    geoip => { ... }
\&    extmon => { ... }
.Ve
.IP "\fBHash-Merge Context\fR" 4
.IX Item "Hash-Merge Context"
The include statement can also appear in a hash where a key would
normally be expected.  In this case, the included file must be in hash
(rather than array) form at the top level, and its contents are merged
into the parent hash.  The merge is shallow, and conflicting keys are
not allowed. Example:
.Sp
.Vb 10
\&  main config:
\&    options => { ... },
\&    plugins => {
\&        extmon => { ... },
\&        $include{geoip.cfg},
\&        $include{plugins.d},
\&    }
\&  geoip.cfg:
\&    geoip => { ... }
\&  plugins.d/foo:
\&    weighted => { ... }
\&    simplefo => { ... }
\&  plugins.d/bar:
\&    metafo => { ... }
.Ve
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fBgdnsd\fR\|(8), \fBgdnsd.zonefile\fR\|(5), \fBgdnsd\-plugin\-simplefo\fR\|(8),
\&\fBgdnsd\-plugin\-multifo\fR\|(8), \fBgdnsd\-plugin\-weighted\fR\|(8),
\&\fBgdnsd\-plugin\-metafo\fR\|(8), \fBgdnsd\-plugin\-geoip\fR\|(8),
\&\fBgdnsd\-plugin\-extmon\fR\|(8), \fBgdnsd\-plugin\-extfile\fR\|(8)
.PP
The gdnsd manual.
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
Copyright (c) 2012 Brandon L Black <blblack@gmail.com>
.PP
This file is part of gdnsd.
.PP
gdnsd is free software: you can redistribute it and/or modify
it under the terms of the \s-1GNU\s0 General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
.PP
gdnsd is distributed in the hope that it will be useful,
but \s-1WITHOUT ANY WARRANTY\s0; without even the implied warranty of
\&\s-1MERCHANTABILITY\s0 or \s-1FITNESS FOR A PARTICULAR PURPOSE.\s0  See the
\&\s-1GNU\s0 General Public License for more details.
.PP
You should have received a copy of the \s-1GNU\s0 General Public License
along with gdnsd.  If not, see <http://www.gnu.org/licenses/>.
